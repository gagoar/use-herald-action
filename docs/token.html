<!DOCTYPE html>

<head>
  <title>UHA - Completing Handshake...</title>
  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
    crossorigin="anonymous"
  />
  <script src="./utils.js"></script>
</head>

<body>
  <div>
    <p id="status">Validating your app...</p>
  </div>
</body>

<script>
  // Get URL parameters
  const { code, orgName } = getParams(window.location.href);

  var xhr = new XMLHttpRequest();
  xhr.open('POST', `https://api.github.com/app-manifests/${code}/conversions`, true);
  xhr.send();

  xhr.onreadystatechange = () => {
    // We're not checking for a 2xx response code because GitHub's endpoint started returning 500s
    //  a few days into development. Unable to repro 2xxs. Despite the bad status codes, the app
    //  in question is still getting created, and that's all we care about here.
    if (xhr.readyState === 4) {
      window.location.replace(`https://cyamonide.github.io/use-herald-action/post-install`);
    }
  };
</script>
