<!DOCTYPE html>

<head></head>

<body>
  <form action="" method="post" id="manifestForm">
    <input type="hidden" name="manifest" id="manifest" />
  </form>

  Hold on tight... we're setting up your app...
</body>

<script src="./getParams.js"></script>

<script>
  // Get URL parameters
  const { orgName } = getParams(window.location.href);

  const manifestJSON = {
    name: `[${orgName}] Use Herald Action App`,
    url: 'https://cyamonide.github.io/use-herald-action',
    redirect_url: 'https://cyamonide.github.io/use-herald-action/token',
    public: true,
    default_permissions: {
      // repo permissions
      actions: 'read',
      administration: 'read',
      contents: 'read',
      issues: 'write',
      metadata: 'read',
      'pull requests': 'write',
      statuses: 'write',
      // org permissions
      members: 'read',
      'team discussions': 'read',
    },
  };

  // Set up manifest
  input = document.getElementById('manifest');
  input.value = JSON.stringify(manifestJSON);

  // Customize form action
  document.getElementById('manifestForm').action = `https://github.com/organizations/${orgName}/settings/apps/new`;

  // Submit form
  document.getElementById('manifestForm').submit();
</script>
